<!-- TEST 13:10 -->
<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Tetris</title>
<style>
  body { margin:0; display:flex; justify-content:center; align-items:center; height:100vh; background:#111; color:white; font-family:monospace;}
  #game { display:grid; grid-template-columns:repeat(10,30px); grid-template-rows:repeat(20,30px); gap:1px; background:#222;}
  .cell { width:30px; height:30px; background:#111; border:1px solid #222;}
  .filled { border:1px solid #fff;}
  .I{background:cyan;}
  .O{background:yellow;}
  .T{background:purple;}
  .S{background:green;}
  .Z{background:red;}
  .J{background:blue;}
  .L{background:orange;}
  #info { margin-left:20px;}
  button{ margin-top:10px; padding:6px 12px; cursor:pointer;}
</style>
</head>
<body>

<div id="game"></div>
<div id="info">
  <div>Score: <span id="score">0</span></div>
  <button id="restartBtn">Neustart</button>
</div>

<script>
const width=10, height=20;
const game=document.getElementById('game');
let cells=[], grid=Array.from({length:height}, ()=>Array(width).fill('')), current, xPos, yPos, score=0, timer;

// Tetromino Shapes
const tetrominos = {
  I: [[1,1,1,1]],
  O: [[1,1],[1,1]],
  T: [[0,1,0],[1,1,1]],
  S: [[0,1,1],[1,1,0]],
  Z: [[1,1,0],[0,1,1]],
  J: [[1,0,0],[1,1,1]],
  L: [[0,0,1],[1,1,1]]
};
const colors = {I:'I',O:'O',T:'T',S:'S',Z:'Z',J:'J',L:'L'};

// Grid initialisieren
for(let i=0;i<width*height;i++){
  const div=document.createElement('div');
  div.classList.add('cell');
  game.appendChild(div);
  cells.push(div);
}

function draw(){
  cells.forEach((c,i)=>{
    const x=i%width, y=Math.floor(i/width);
    const val = grid[y][x];
    c.className='cell';
    if(val) c.classList.add('filled', val);
  });
}

// Random Tetromino
function newTetromino(){
  const keys=Object.keys(tetrominos);
  const t=keys[Math.floor(Math.random()*keys.length)];
  current={shape: tetrominos[t], type: colors[t]};
  xPos=Math.floor(width/2 - Math.ceil(current.shape[0].length/2));
  yPos=-current.shape.length;
  if(!valid(xPos,yPos,current.shape)) gameOver();
}

// Prüfen ob Bewegung gültig
function valid(x,y,shape){
  for(let r=0;r<shape.length;r++){
    for(let c=0;c<shape[r].length;c++){
      if(shape[r][c]){
        const newX=x+c, newY=y+r;
        if(newX<0||newX>=width||newY>=height) return false;
        if(newY>=0 && grid[newY][newX]) return false;
      }
    }
  }
  return true;
}

// Tetromino setzen
function place(x,y,shape,type){
  for(let r=0;r<shape.length;r++){
    for(let c=0;c<shape[r].length;c++){
      if(shape[r][c] && y+r>=0) grid[y+r][x+c]=type;
    }
  }
}

// Clear current Tetromino
function clearCurrent(x,y,shape){
  for(let r=0;r<shape.length;r++){
    for(let c=0;c<shape[r].length;c++){
      if(shape[r][c] && y+r>=0) grid[y+r][x+c]='';
    }
  }
}

// Rotation
function rotate(shape){
  return shape[0].map((_,i)=>shape.map(row=>row[i]).reverse());
}

// Linien löschen
function clearLines(){
  for(let y=height-1;y>=0;y--){
    if(grid[y].every(c=>c)){
      grid.splice(y,1);
      grid.unshift(Array(width).fill(''));
      score+=10;
      document.getElementById('score').textContent=score;
      y++;
    }
  }
}

// Game Over
function gameOver(){
  clearInterval(timer);
  alert('Game Over! Score: '+score);
}

// Tick (Fallen lassen)
function tick(){
  clearCurrent(xPos,yPos,current.shape);
  if(valid(xPos,yPos+1,current.shape)){
    yPos++;
  } else {
    place(xPos,yPos,current.shape,current.type);
    clearLines();
    newTetromino();
  }
  place(xPos,yPos,current.shape,current.type);
  draw();
}

// Key Steuerung
document.addEventListener('keydown', e=>{
  clearCurrent(xPos,yPos,current.shape);
  if(e.key==='ArrowLeft' && valid(xPos-1,yPos,current.shape)) xPos--;
  if(e.key==='ArrowRight' && valid(xPos+1,yPos,current.shape)) xPos++;
  if(e.key==='ArrowDown' && valid(xPos,yPos+1,current.shape)) yPos++;
  if(e.key==='ArrowUp'){
    const rotated=rotate(current.shape);
    if(valid(xPos,yPos,rotated)) current.shape=rotated;
  }
  place(xPos,yPos,current.shape,current.type);
  draw();
});

// Neustart
document.getElementById('restartBtn').onclick = ()=>{
  grid = Array.from({length:height}, ()=>Array(width).fill(''));
  score=0;
  document.getElementById('score').textContent=score;
  clearInterval(timer);
  newTetromino();
  timer=setInterval(tick,500);
};

// Start
newTetromino();
timer=setInterval(tick,500);
</script>

</body>
</html>
