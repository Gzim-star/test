<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>BrainTrials ‚Äì State & IQ Puzzle</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<style>
body {
  margin: 0;
  height: 100vh;
  background: black;
  overflow: hidden;
  display: flex;
  justify-content: center;
  align-items: center;
  font-family: Arial, sans-serif;
}

/* FLOW BILD */
#flowImage {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  cursor: pointer;
  transition: opacity 1.4s ease;
  z-index: 10;
}

/* GAME WRAPPERS */
.game-wrapper {
  position: absolute;
  display: flex;
  flex-direction: column;
  align-items: center;
  opacity: 0;
  pointer-events: none;
  transition: opacity 1.5s ease;
  z-index: 20;
}

/* SHOW */
.game-wrapper.show {
  opacity: 1;
  pointer-events: auto;
}

/* GRID */
.grid {
  display: grid;
  grid-template-columns: repeat(12, min(24px, 6vw));
  grid-template-rows: repeat(12, min(24px, 6vw));
  gap: 9px;
}

.cell {
  background: white;
  border-radius: 10%;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: calc(12px + 0.5vmin);
  font-weight: bold;
  color: black;
  user-select: none;
}

.cell.correct { background: #0f0; }
.cell.wrong { background: #f00; }

.cell.active { opacity: 0.4; }

#message {
  margin-top: 12px;
  font-size: 18px;
  color: #0f0;
}

/* L√∂sung Overlay */
#solutionOverlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.55);
  display: flex;
  align-items: center;
  justify-content: center;
  padding-top: 60px;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.4s ease;
  z-index: 50;
}

#solutionOverlay.show {
  opacity: 1;
  pointer-events: auto;
}

/* L√∂sung Box */
#solutionBox {
  background: black;
  color: white;
  padding: 10px 12px;
  border-radius: 0px;
  font-size: 25px;
  line-height: 1.4;
  width: 90vw;
  max-width: 90vh;
  overflow-y: auto;
  text-align: center;
}

#solutionBtn {
  margin-top: 24px;
  align-self: center;
  background: rgba(255,255,255,0.85);
  color: black;
  border: none;
  padding: 8px 14px;
  font-size: 13px;
  cursor: pointer;
}
#iqSolutionOverlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.55);
  display: flex;
  align-items: center;
  justify-content: center;
  padding-top: 60px;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.4s ease;
  z-index: 50;
}

#iqSolutionOverlay.show {
  opacity: 1;
  pointer-events: auto;
}

#iqSolutionBox {
  background: black;
  color: white;
  padding: 10px 12px;
  border-radius: 0px;
  font-size: 25px;
  line-height: 1.4;
  width: 90vw;
  max-width: 90vh;
  overflow-y: auto;
  text-align: center;
}

#iqSolutionBtn {
  margin-top: 24px;
  align-self: center;
  background: rgba(255,255,255,0.85);
  color: black;
  border: none;
  padding: 8px 14px;
  font-size: 13px;
  cursor: pointer;
}
</style>
</head>

<body>

<!-- FLOW -->
<img id="flowImage" src="IMG_1467.jpeg" alt="Flow">

<!-- STATE PUZZLE -->
<div id="stateWrapper" class="game-wrapper">
  <div id="solutionOverlay">
    <div id="solutionBox"></div>
  </div>
  <div id="stateGrid" class="grid"></div>
  <button id="solutionBtn"></button>
</div>

<!-- IQ PUZZLE -->
<!-- IQ PUZZLE -->
<div id="iqWrapper" class="game-wrapper">
  <h1 style="color:white"></h1>
  <div id="iqGrid" class="grid"></div>
  <div id="message"></div>
  <button id="iqSolutionBtn"></button>  <!-- üëà neuer Button -->
  <div id="iqSolutionOverlay">
    <div id="iqSolutionBox"></div>
  </div>
</div>

<script>
// ===== GLOBAL =====
const flowImage = document.getElementById("flowImage");

// STATE
const stateWrapper = document.getElementById("stateWrapper");
const stateGrid = document.getElementById("stateGrid");
const solutionBtn = document.getElementById("solutionBtn");
const solutionOverlay = document.getElementById("solutionOverlay");
const solutionBox = document.getElementById("solutionBox");

let size = 12;
let state = [];
let solvedState = false;
let currentIQWords = []; // <-- speichert die 6 aktuell gew√§hlten W√∂rter
// IQ
const iqWrapper = document.getElementById("iqWrapper");
const iqGrid = document.getElementById("iqGrid");
const message = document.getElementById("message");
// IQ L√∂sungs-Button & Overlay
const iqSolutionBtn = document.getElementById("iqSolutionBtn");
const iqSolutionOverlay = document.getElementById("iqSolutionOverlay");
const iqSolutionBox = document.getElementById("iqSolutionBox");

iqSolutionBtn.onclick = () => {
  iqSolutionBox.innerHTML = currentIQWords
    .map(w => `<span style="display:inline-block;min-width:60px;margin:2px 6px;opacity:.85">${w}</span>`)
    .join("");

  iqSolutionOverlay.classList.add("show");

  setTimeout(() => iqSolutionOverlay.classList.remove("show"), 5000);
};

// Klick irgendwo schlie√üt Overlay
iqSolutionOverlay.onclick = () => iqSolutionOverlay.classList.remove("show");
const alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
const words = [
  "GZIM",  "MIND", "FLOW", "FOCUS", "VOID", "TRACE",
  "LOGIC", "BRAIN", "THINK", "SHIFT", "AWARE",
  "DEPTH", "VISION", "PATTERN", "REACT",
  "MEMORY", "ATTENTION", "COGNITION"
];

let positions = [];
let currentIndex = 0;
let globalOrder = 0;

// ===== FLOW ‚Üí STATE PUZZLE =====
flowImage.onclick = () => {
  flowImage.style.opacity = 0;
  setTimeout(() => {
    flowImage.style.display = "none";
    stateWrapper.classList.add("show");
    startStatePuzzle();
  }, 1400);
};

// ===== STATE PUZZLE =====
function initState() {
  state = [];
  solvedState = false;
  for (let i = 0; i < size * size; i++) {
    state[i] = Math.random() > 0.5 ? 1 : 0;
  }
}

function startStatePuzzle() {
  initState();
  renderState();
}

// RENDER STATE
function renderState() {
  stateGrid.innerHTML = "";
  state.forEach((v,i)=>{
    const cell = document.createElement("div");
    cell.className = "cell" + (v?" active":"");
    const row = Math.floor(i/size);
    const col = i%size;

    if(row===0 && col===0) cell.textContent="1";
    else if(row===0) cell.textContent=col+1;
    else if(col===0) cell.textContent=row+1;
    else if(col===size-1) cell.textContent=size-row;
    else if(row===size-1) cell.textContent=size-col;

    cell.onclick = ()=>{
      if(!solvedState) toggleState(i);
    };

    stateGrid.appendChild(cell);
  });

  checkSolvedState();
}

// TOGGLE STATE
function toggleState(i) {
  const n = [i,i-1,i+1,i-size,i+size];
  n.forEach(x=>{
    if(x>=0 && x<size*size && Math.abs((x%size)-(i%size))<=1){
      state[x]^=1;
    }
  });
  renderState();
}

// CHECK STATE SOLVED
function checkSolvedState(){
  if(solvedState) return;
  if(state.every(v=>v===0)){
    solvedState=true;
    stateWrapper.classList.remove("show");
    setTimeout(()=>{
      startIQPuzzle();
    },1500);
  }
}

// SOLUTION BUTTON
solutionBtn.onclick = ()=>{
  solutionBox.innerHTML = solvePuzzle(state).map(p=>{
    const [r,c] = p.match(/\d+/g);
    return `<span style="display:inline-block;min-width:60px;margin:2px 6px;opacity:.85">${r} ' ${c}</span>`;
  }).join("");
  solutionOverlay.classList.add("show");
  setTimeout(()=>solutionOverlay.classList.remove("show"),5000);
};

solutionOverlay.onclick = ()=>solutionOverlay.classList.remove("show");

// SOLVE PUZZLE (STATE)
function solvePuzzle(state){
  const n=size*size;
  let matrix=[], vector=state.slice();
  for(let i=0;i<n;i++){
    matrix[i]=Array(n).fill(0); matrix[i][i]=1;
    let r=Math.floor(i/size), c=i%size;
    if(r>0) matrix[i][i-size]=1;
    if(r<size-1) matrix[i][i+size]=1;
    if(c>0) matrix[i][i-1]=1;
    if(c<size-1) matrix[i][i+1]=1;
  }
  for(let i=0;i<n;i++){
    if(!matrix[i][i]){
      for(let j=i+1;j<n;j++){
        if(matrix[j][i]){
          [matrix[i],matrix[j]]=[matrix[j],matrix[i]];
          [vector[i],vector[j]]=[vector[j],vector[i]];
          break;
        }
      }
    }
    for(let j=0;j<n;j++){
      if(i!==j && matrix[j][i]){
        for(let k=0;k<n;k++) matrix[j][k]^=matrix[i][k];
        vector[j]^=vector[i];
      }
    }
  }
  return vector.map((v,i)=>v?`(${Math.floor(i/size)+1}, ${i%size+1})`:null).filter(Boolean);
}

// ===== IQ PUZZLE =====
function startIQPuzzle(){
  iqWrapper.classList.add("show");
  generateIQGrid();
}

// GENERATE IQ GRID
function generateIQGrid(){
  iqGrid.innerHTML = ""; 
  message.textContent = "";
  currentIndex = 0; 
  positions = []; 
  globalOrder = 0;

  const WORDS_PER_GRID = 6;
  currentIQWords = [];  // ‚Üê hier speichern wir die gew√§hlten W√∂rter
  while(currentIQWords.length < WORDS_PER_GRID){
    const w = words[Math.floor(Math.random()*words.length)];
    if(!currentIQWords.includes(w)) currentIQWords.push(w);
  }

  const gridData = Array.from({length:12},()=>Array(12).fill(null));
  currentIQWords.forEach(w => placeWordIQ(w, gridData));

  for(let r=0;r<12;r++){
    for(let c=0;c<12;c++){
      const div=document.createElement("div");
      div.className="cell";
      if(gridData[r][c]){
        div.textContent=gridData[r][c].letter;
        positions.push({div, order:gridData[r][c].order});
      } else {
        div.textContent = alphabet[Math.floor(Math.random()*alphabet.length)];
      }
      div.onclick = ()=>checkClickIQ(div);
      iqGrid.appendChild(div);
    }
  }

  positions.sort((a,b)=>a.order-b.order);
}

// PLACE WORD IQ
function placeWordIQ(word,gridData){
  const len=word.length; let placed=false;
  while(!placed){
    const mode=Math.floor(Math.random()*4);
    const maxRow=(mode===0||mode===3)?12:12-len;
    const maxCol=(mode===1||mode===2||mode===3)?12-len:12;
    const sr=Math.floor(Math.random()*maxRow);
    const sc=Math.floor(Math.random()*maxCol);
    let fits=true;
    for(let i=0;i<len;i++){
      let r=sr+(mode===1||mode===2?i:0);
      let c=sc+(mode===0||mode===2?i:0);
      if(mode===3){ r=sr-i; c=sc+i; }
      if(r<0||r>=12||c<0||c>=12||gridData[r][c]){fits=false; break;}
    }
    if(!fits) continue;
    for(let i=0;i<len;i++){
      let r=sr+(mode===1||mode===2?i:0);
      let c=sc+(mode===0||mode===2?i:0);
      if(mode===3){ r=sr-i; c=sc+i;}
      gridData[r][c]={letter:word[i],order:globalOrder++};
    }
    placed=true;
  }
}

// CHECK CLICK IQ
function checkClickIQ(div){
  const expected=positions[currentIndex]?.div;
  if(div===expected){
    div.classList.add("correct"); currentIndex++;
    if(currentIndex===positions.length){
      setTimeout(()=>{ exitToFlow(); },800);
    }
  }else{
    div.classList.add("wrong");
    setTimeout(()=>div.classList.remove("wrong"),700);
  }
}

// EXIT IQ ‚Üí FLOW
function exitToFlow(){
  iqWrapper.classList.remove("show");
  setTimeout(()=>{
    flowImage.style.display="block";
    flowImage.style.opacity=1;
  },1500);
}

</script>

</body>
</html>
