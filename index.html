<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport"
content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<title>Word Fall</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  background: #111;
  overflow: hidden;
  touch-action: manipulation;
  overscroll-behavior: none;
  font-family: system-ui, sans-serif;
}

.game {
  position: fixed;
  inset: 0;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}

.hint {
  color: #fff;
  font-size: 24px;
  margin-bottom: 10px;
  font-family: monospace;
}

canvas {
  background: #000;
  border: 3px solid #444;
  touch-action: none;
}
.controls {
  margin-top: 10px;
  display: flex;
  gap: 10px;
}

.controls button {
  background: #222;
  color: #fff;
  border: 1px solid #444;
  padding: 12px 16px;
  font-size: 18px;
  border-radius: 6px;
}
</style>
</head>

<body>

<div class="game">
  <div class="hint"><span id="wordHint">Hint</span></div>
  <canvas id="wordFallCanvas" width="300" height="600"></canvas>

  <div class="controls">
    <button onclick="startGame()">Start</button>
    <button onclick="move(-1)">â—€</button>
    <button onclick="dropFast()">â–¼</button>
    <button onclick="move(1)">â–¶</button>
    <button onclick="restartGame()">Reset</button>
  </div>
</div>

<script>
/* ===== DOUBLE TAP ZOOM KILLER ===== */
let lastTouchEnd = 0;
document.addEventListener('touchend', e => {
  const now = Date.now();
  if (now - lastTouchEnd <= 300) e.preventDefault();
  lastTouchEnd = now;
}, { passive: false });

/* ===== CANVAS ===== */
const canvas = document.getElementById('wordFallCanvas');
const ctx = canvas.getContext('2d');
ctx.scale(30, 30);

/* ===== DICTIONARY ===== */
const WORDS = [
  'ABOMINABLE', 'REPOSITORY', 'CROSSBREED', 'DISASTROUS',
  'EVERYTHING', 'FASCINATOR', 'REFRESHING', 'HEARTBEATS',
  'IMMEDIATES', 'JOURNALISM', 'KNIGHTHOOD', 'LANDSCAPER',
  'MASTERMIND', 'NIGHTSTAND', 'OPERATIONS', 'POPULATION',
  'QUARTERBACK', 'RENDEZVOUS', 'SCRATCHING', 'LEGENDARYS',
  'UNDERTAKER', 'VOLUNTEERS', 'WATERMELON', 'XENOPHOBIC',
  'YELLOWHAZE', 'ZOOLOGISTS'
];
const MIN_LEN = 10;
const COLORS = ['#00ffcc', '#ffcc00', '#ff6699', '#66ff66', '#66ccff'];
function shuffleWords() {
  wordQueue = [...WORDS].sort(() => Math.random() - 0.5);
  wordIndex = 0;
}
/* ===== ARENA ===== */
const arena = Array.from({ length: 20 }, () => Array(10).fill(null));
const highlights = Array.from({ length: 20 }, () => Array(10).fill(null));

const player = { pos: { x: 0, y: 0 }, letter: '' };
let targetWord = '';
let gameRunning = false;
let wordQueue = [];
let wordIndex = 0;
/* ===== TARGET WORD HINT ===== */
function newTargetWord() {
  if (wordQueue.length === 0 || wordIndex >= wordQueue.length) {
    shuffleWords();
  }

  targetWord = wordQueue[wordIndex];
  wordIndex++;

  document.getElementById('wordHint').textContent = targetWord;
}

/* ===== GAME LOGIC ===== */
function collide(arena, player) {
  const { x, y } = player.pos;
  return y >= arena.length || x < 0 || x >= arena[0].length || arena[y][x] !== null;
}

function merge(arena, player) { arena[player.pos.y][player.pos.x] = player.letter; }

function move(dir) { 
  player.pos.x += dir; 
  if (collide(arena, player)) player.pos.x -= dir; 
}

function drop() {
  if (!gameRunning) return;
  player.pos.y++;
  if (collide(arena, player)) {
    player.pos.y--;
    merge(arena, player);
    checkAndClearWords();
    clearDiagonalSixByColor();
    resetPlayer();
  }
}

/* ===== WORD DETECTION ===== */
function checkAndClearWords() {
  clearHighlights();
  const found = findWords();
  if (!found.length) return;

  let targetFound = false;
  const frameX = 8;  // X-Koordinate des grauen Rahmens
  const frameY = 5;  // Y-Koordinate oben
  const frameH = 10; // HÃ¶he

  found.forEach(group => {
    const letters = group.map(([y,x]) => arena[y][x]).join('');
    if (letters.toUpperCase() === targetWord) {
      // PrÃ¼fen, ob alle Buchstaben innerhalb des grauen Rahmens liegen
      const inFrame = group.every(([y,x]) => 
        x >= frameX && x < frameX + 1 &&
        y >= frameY && y < frameY + frameH
      );
      if (inFrame) targetFound = true;
    }

    const color = COLORS[Math.floor(Math.random()*COLORS.length)];
    group.forEach(([y,x]) => highlights[y][x] = color);
  });

  setTimeout(() => {
    if (targetFound) {
      arena.forEach(row => row.fill(null));
      newTargetWord();
      resetPlayer();
      clearHighlights();
      return;
    }
    found.flat().forEach(([y,x])=>arena[y][x]=null);
    applyGravity();
    clearHighlights();
  }, 300);
}

function findWords() {
  const found=[];
  for(let y=0;y<arena.length;y++){
    let word='',pos=[];
    for(let x=0;x<=arena[0].length;x++){
      const c=arena[y][x];
      if(c){ word+=c; pos.push([y,x]); }
      else{ extract(word,pos,found); word=''; pos=[]; }
    }
  }
  for(let x=0;x<arena[0].length;x++){
    let word='',pos=[];
    for(let y=0;y<=arena.length;y++){
      const c=arena[y]?.[x];
      if(c){ word+=c; pos.push([y,x]); }
      else{ extract(word,pos,found); word=''; pos=[]; }
    }
  }
  return found;
}

function extract(word,pos,found){
  if(word.length<MIN_LEN) return;
  const upperWord = word.toUpperCase();
  WORDS.forEach(w=>{const i=upperWord.indexOf(w); if(i!==-1) found.push(pos.slice(i,i+w.length)); });
}

function clearDiagonalSixByColor() {
  const toClear = [];
  for (let y = arena.length - 1; y >= 0; y--) {
    for (let x = 0; x < arena[0].length; x++) {
      if (!arena[y][x]) continue;
      const baseColor = COLORS[(x + y) % COLORS.length];
      const chain = [[y, x]];
      let ny = y - 1;
      let nx = x + 1;
      while (
        ny >= 0 &&
        nx < arena[0].length &&
        arena[ny][nx] &&
        COLORS[(nx + ny) % COLORS.length] === baseColor
      ) {
        chain.push([ny, nx]);
        ny--;
        nx++;
      }
      if (chain.length >= 6) {
        chain.forEach(p => toClear.push(p));
      }
    }
  }
  if (!toClear.length) return;
  toClear.forEach(([y, x]) => { highlights[y][x] = '#ff3333'; });
  setTimeout(() => {
    toClear.forEach(([y, x]) => { arena[y][x] = null; });
    applyGravity();
    clearHighlights();
  }, 250);
}

/* ===== GRAVITY ===== */
function applyGravity(){
  for(let x=0;x<arena[0].length;x++){
    for(let y=arena.length-1;y>=0;y--){
      if(arena[y][x]===null){
        for(let k=y-1;k>=0;k--){
          if(arena[k][x]!==null){ arena[y][x]=arena[k][x]; arena[k][x]=null; break; }
        }
      }
    }
  }
}

/* ===== PLAYER ===== */
function randomLetter(){ return String.fromCharCode(65+Math.floor(Math.random()*26)); }

function resetPlayer(){
  player.letter = randomLetter();
  player.pos.y = 0;
  player.pos.x = Math.floor(arena[0].length/2);
  if(collide(arena,player)) arena.forEach(row=>row.fill(null));
}

/* ===== DRAW ===== */
function clearHighlights(){ highlights.forEach(row=>row.fill(null)); }

function draw(){
  ctx.fillStyle='#000'; 
  ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.font='1px monospace'; 
  ctx.textAlign='center'; 
  ctx.textBaseline='middle';

  // ðŸ”² GRAUER RAHMEN
  const frameX = 8;
  const frameY = 5;
  const frameH = 10;
  ctx.fillStyle = '#808080';
  ctx.fillRect(frameX + 0.05, frameY - 0.3, 0.9, frameH - 0.2);

  arena.forEach((row,y)=>{
    row.forEach((v,x)=>{
      if(v){ 
        ctx.fillStyle = highlights[y][x]||COLORS[(x+y)%COLORS.length]; 
        ctx.fillText(v,x+0.5,y+0.5); 
      }
    });
  });

  ctx.fillStyle = COLORS[(player.pos.x+player.pos.y)%COLORS.length];
  ctx.fillText(player.letter,player.pos.x+0.5,player.pos.y+0.5);
}

/* ===== LOOP ===== */
let lastTime=0, dropCounter=0, dropInterval=700;
function update(time=0){
  const delta = time - lastTime;
  lastTime=time;
  if(gameRunning){
    dropCounter+=delta;
    if(dropCounter>dropInterval){ drop(); dropCounter=0; }
  }
  draw();
  requestAnimationFrame(update);
}

/* ===== INPUT ===== */
document.addEventListener('keydown',e=>{
  if(e.key==='ArrowLeft') move(-1);
  if(e.key==='ArrowRight') move(1);
  if(e.key==='ArrowDown') drop();
});

/* ===== BUTTONS ===== */
function startGame(){ if(!gameRunning){ gameRunning = true; resetPlayer(); newTargetWord(); } }
if (wordQueue.length === 0) shuffleWords();
function restartGame(){ arena.forEach(row => row.fill(null)); clearHighlights(); resetPlayer(); newTargetWord(); dropCounter = 0; gameRunning = true; }
function dropFast(){ if(!gameRunning) return; while(!collide(arena, player)){ player.pos.y++; } player.pos.y--; merge(arena, player); checkAndClearWords(); clearDiagonalSixByColor(); resetPlayer(); }

/* ===== INIT ===== */
update();
</script>

</body>
</html>

