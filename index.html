<!-- TEST 13:10 -->
<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Tetris</title>
<style>
  body {
    margin: 0;
    background: #111;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    color: white;
    font-family: monospace;
  }
  #game {
    display: grid;
    grid-template-columns: repeat(10, 30px);
    grid-template-rows: repeat(20, 30px);
    gap: 1px;
    background: #222;
  }
  .cell {
    width: 30px;
    height: 30px;
    background: #111;
    border: 1px solid #222;
  }
  .filled {
    background: orange;
    border: 1px solid #fff;
  }
  .I { background: cyan; }
  .O { background: yellow; }
  .T { background: purple; }
  .S { background: green; }
  .Z { background: red; }
  .J { background: blue; }
  .L { background: orange; }

  #info {
    margin-left: 20px;
  }
  button {
    margin-top: 10px;
    padding: 6px 12px;
    cursor: pointer;
  }
</style>
</head>
<body>

<div id="game"></div>
<div id="info">
  <div>Score: <span id="score">0</span></div>
  <button id="restartBtn">Neustart</button>
</div>

<script>
const width = 10;
const height = 20;
const game = document.getElementById('game');
let cells = [];
let grid = Array.from({length: height}, ()=>Array(width).fill(''));
let current, currentX, currentY;
let score = 0;
let timer;

// Tetrominos
const tetrominos = {
  I: [[1,1,1,1]],
  O: [[1,1],[1,1]],
  T: [[0,1,0],[1,1,1]],
  S: [[0,1,1],[1,1,0]],
  Z: [[1,1,0],[0,1,1]],
  J: [[1,0,0],[1,1,1]],
  L: [[0,0,1],[1,1,1]]
};

const colors = {
  I:'I', O:'O', T:'T', S:'S', Z:'Z', J:'J', L:'L'
};

// Init grid
for(let i=0;i<width*height;i++){
  const div=document.createElement('div');
  div.classList.add('cell');
  game.appendChild(div);
  cells.push(div);
}

function draw(){
  cells.forEach((c,i)=>{
    const x=i%width;
    const y=Math.floor(i/width);
    const val = grid[y][x];
    c.className='cell';
    if(val) c.classList.add('filled', val);
  });
}

// Tetromino erstellen
function randomTetromino(){
  const keys = Object.keys(tetrominos);
  const t = keys[Math.floor(Math.random()*keys.length)];
  return {shape: tetrominos[t], type: colors[t]};
}

// Prüfen ob Tetromino platziert werden kann
function valid(x,y,shape){
  for(let r=0;r<shape.length;r++){
    for(let c=0;c<shape[r].length;c++){
      if(shape[r][c]){
        const newX = x+c;
        const newY = y+r;
        if(newX<0||newX>=width||newY>=height) return false;
        if(newY>=0 && grid[newY][newX]) return false;
      }
    }
  }
  return true;
}

// Tetromino setzen
function placeTetromino(x,y,shape,type){
  for(let r=0;r<shape.length;r++){
    for(let c=0;c<shape[r].length;c++){
      if(shape[r][c] && y+r>=0) grid[y+r][x+c]=type;
    }
  }
}

// Clear current tetromino (vor Bewegung)
function clearCurrent(x,y,shape){
  for(let r=0;r<shape.length;r++){
    for(let c=0;c<shape[r].length;c++){
      if(shape[r][c] && y+r>=0) grid[y+r][x+c]='';
    }
  }
}

// Rotation 90°
function rotate(shape){
  return shape[0].map((_,i)=>shape.map(row=>row[i]).reverse());
}

// Linien löschen
function clearLines(){
  for(let y=height-1;y>=0;y--){
    if(grid[y].every(c=>c)){
      grid.splice(y,1);
      grid.unshift(Array(width).fill(''));
      score+=10;
      document.getElementById('score').textContent=score;
      y++; 
    }
  }
}

// Game Over prüfen
function gameOver(){
  if(grid[0].some(c=>c)){
    clearInterval(timer);
    alert('Game Over! Score: '+score);
  }
}

// Neues Tetromino starten
function newTetromino(){
  current = randomTetromino();
  currentX = Math.floor(width/2 - Math.ceil(current.shape[0].length/2));
  currentY = -current.shape.length;
  if(!valid(currentX,currentY,current.shape)) gameOver();
}

// Fallen lassen
function tick(){
  clearCurrent(currentX,currentY,current.shape);
  if(valid(currentX,currentY+1,current.shape)){
    currentY++;
  } else {
    placeTetromino(currentX,currentY,current.shape,current.type);
    clearLines();
    newTetromino();
  }
  placeTetromino(currentX,currentY,current.shape,current.type);
  draw();
}

// Key Steuerung
document.addEventListener('keydown', e=>{
  clearCurrent(currentX,currentY,current.shape);
  if(e.key==='ArrowLeft' && valid(currentX-1,currentY,current.shape)) currentX--;
  if(e.key==='ArrowRight' && valid(currentX+1,currentY,current.shape)) currentX++;
  if(e.key==='ArrowDown' && valid(currentX,currentY+1,current.shape)) currentY++;
  if(e.key==='ArrowUp'){
    const rotated = rotate(current.shape);
    if(valid(currentX,currentY,rotated)) current.shape = rotated;
  }
  placeTetromino(currentX,currentY,current.shape,current.type);
  draw();
});

// Neustart
document.getElementById('restartBtn').onclick = ()=>{
  grid = Array.from({length: height}, ()=>Array(width).fill(''));
  score=0;
  document.getElementById('score').textContent=score;
  clearInterval(timer);
  newTetromino();
  timer=setInterval(tick,500);
};

// Start
newTetromino();
timer=setInterval(tick,500);
</script>

</body>
</html>
